---
import type { CollectionEntry } from "astro:content";
import App from "./App.astro";
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import FormattedDate from "../components/FormattedDate.astro";
import BadgeMini from "../components/BadgeMini.astro";

// type Props = CollectionEntry<'blog'>['data'];

const { title, description, eventDate, heroImage, location } = Astro.props;
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/public/assets/**/*.{jpeg,jpg,png,gif,avif}",
);
const finalImageUrl = `/public${heroImage}`;
if (!images[finalImageUrl])
  throw new Error(
    `"${finalImageUrl}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`,
  );
---

<App title={title} description={description} image={heroImage}>
  <main>
    <div class="hero-header">
      <div class="hero-bg">
        <div class="hero-pattern"></div>
      </div>
    </div>
    <article class="container mx-auto px-2">
      <div class="hero-image-wrapper">
        {
          finalImageUrl && (
            <div class="hero-image not-prose rounded-xl overflow-hidden shadow-xl">
              <Image
                src={images[finalImageUrl]()}
                widths={[100, 200, 300, 500, 800]}
                sizes={`(max-width: 360px) 100px, (max-width: 460px) 200px,(max-width: 560px) 300px,(max-width: 660px) 500px, 800px`}
                alt=""
                class="w-full h-auto"
                loading="eager"
              />
            </div>
          )
        }
      </div>
      <div class="prose mx-auto">
        <div class="py-4">
          <BadgeMini>
            <b>Am:</b>
            {
              eventDate.toLocaleDateString("de-DE", { weekday: "short" })
            },<FormattedDate date={eventDate} time={false} />
          </BadgeMini>
          {
            location && (
              <BadgeMini>
                <strong>Ort:</strong> {location}
              </BadgeMini>
            )
          }
        </div>
        <div>
          <h1 class="text-4xl my-0">{title}</h1>
        </div>
        <div>
          <slot />
        </div>
      </div>
    </article>
  </main>
</App>

<style>
  .hero-header {
    position: relative;
    height: 14rem;
    overflow: visible;
  }

  .hero-bg {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      135deg,
      #b91c1c 0%,
      #b91c1c 50%,
      #171717 50%,
      #171717 100%
    );
    overflow: hidden;
  }

  .hero-pattern {
    position: absolute;
    inset: 0;
    /* background-image: url('/assets/bg-pattern.avif'); */
    background-repeat: space;
    opacity: 0.1;
    filter: grayscale(100%) brightness(1) invert(1);
    mix-blend-mode: screen;
  }

  .hero-bg::after {
    content: "";
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 14rem;
    background: linear-gradient(to bottom, transparent, white);
  }

  .hero-image-wrapper {
    max-width: 90ch;
    margin: 0 auto;
    margin-top: -10rem;
    position: relative;
    z-index: 10;
  }

  .hero-image {
    border: 4px solid white;
    background-color: silver;
  }

  @media (min-width: 768px) {
    .hero-header {
      height: 18rem;
    }

    .hero-image-wrapper {
      margin-top: -13rem;
    }

    .hero-pattern {
      background-size: 100px 100px;
    }
  }

  @media (min-width: 1024px) {
    .hero-header {
      height: 22rem;
    }

    .hero-image-wrapper {
      margin-top: -16rem;
    }
  }
</style>
<style is:global>
  .prose p > img {
    width: 100%;
    display: block;
  }
</style>
