---
import HeaderLink from "./HeaderLink.astro";
import { SITE_TITLE } from "../consts";

// Icons from Icones.js.org, Phosphor, Bold
export const menuItems = [
  {
    label: "Startseite",
    slug: "/",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" aria-hidden="true"><path fill="currentColor" d="M240 204h-12v-88.45a20.07 20.07 0 0 0-6.44-14.7l-79.95-75.47l-.16-.15a19.93 19.93 0 0 0-26.91 0l-.17.15l-79.93 75.47a20.07 20.07 0 0 0-6.44 14.7V204H16a12 12 0 0 0 0 24h224a12 12 0 0 0 0-24ZM52 117.28l76-71.75l76 71.75V204h-40v-44a20 20 0 0 0-20-20h-32a20 20 0 0 0-20 20v44H52ZM140 204h-24v-40h24Z"/></svg>`,
  },
  {
    label: "Veranstaltungen",
    slug: "/veranstaltungen",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" aria-hidden="true"><path fill="currentColor" d="M208 28h-20v-4a12 12 0 0 0-24 0v4H92v-4a12 12 0 0 0-24 0v4H48a20 20 0 0 0-20 20v160a20 20 0 0 0 20 20h160a20 20 0 0 0 20-20V48a20 20 0 0 0-20-20ZM68 52a12 12 0 0 0 24 0h72a12 12 0 0 0 24 0h16v24H52V52ZM52 204V100h152v104Z"/></svg>`,
  },
  {
    label: "Sportheim",
    slug: "/sportheim",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" aria-hidden="true"><path fill="currentColor" d="M216 84h-12V72a44.05 44.05 0 0 0-44-44h-9.73c-12.5-10.22-29.09-16-46.27-16c-37.5 0-68 26.92-68 60v136a20 20 0 0 0 20 20h128a20 20 0 0 0 20-20v-4h12a28 28 0 0 0 28-28v-64a28 28 0 0 0-28-28ZM104 36c12.85 0 25 4.62 33.44 12.67a12 12 0 0 0 8.3 3.33H160a20 20 0 0 1 19.6 16H60.28C62.72 50 81.39 36 104 36Zm76 168H60V92h120Zm40-28a4 4 0 0 1-4 4h-12v-72h12a4 4 0 0 1 4 4Zm-112-56v56a12 12 0 0 1-24 0v-56a12 12 0 0 1 24 0Zm48 0v56a12 12 0 0 1-24 0v-56a12 12 0 0 1 24 0Z"/></svg>`,
  },
];

const isMaintenanceMode = false;
---

<header role="banner">
  <div class="wrapper text-gray-700">
    <div class="w-24 md:w-24 h-12 md:h-16 relative">
      <a 
        class="block w-24 md:w-28 h-18 md:h-24 p-3 rounded-md shadow-sm hover:shadow-lg bg-white absolute top-0 left-0 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-700 focus-visible:ring-offset-2" 
        href="/" 
        aria-label={`${SITE_TITLE} - Zur Startseite`}
      >
        <img 
          width="116" 
          height="95" 
          src="/assets/logo_sco_min.png" 
          alt="SCO-OGV Oberfüllbach 1963 e.V. Logo" 
          loading="eager"
        />
      </a>
    </div>
    {
      !isMaintenanceMode && (
        <>
          <nav id="navigation" class="pointer-events-none md:pointer-events-auto hidden md:block" role="navigation" aria-label="Hauptnavigation">
            <ul class="flex gap-4" role="list">
              {menuItems.map((menuItem) => (
                <li role="none">
                  <HeaderLink href={menuItem.slug}>
                    <>
                      <span class="icon" set:html={menuItem.icon} aria-hidden="true" />
                      <span>{menuItem.label}</span>
                    </>
                  </HeaderLink>
                </li>
              ))}
            </ul>
          </nav>
          <nav class="md:hidden md:pointer-events-none" role="navigation" aria-label="Mobile Navigation">
            <button
              type="button"
              class="open-btn inline-flex gap-2 items-center px-5 h-10 justify-center rounded-full md:hidden bg-neutral-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-700 focus-visible:ring-offset-2"
              aria-expanded="false"
              aria-controls="mobile-menu"
            >
              <span class="sr-only">Hauptmenü öffnen</span>
              <svg
                class="w-5 h-5"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 17 14"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M1 1h15M1 7h15M1 13h15"
                />
              </svg>
              <span class="font-semibold">Menü</span>
            </button>
          </nav>
        </>
      )
    }

  </div>
</header>

<!-- Mobile Menu Backdrop -->
<div id="mobile-backdrop" class="mobile-backdrop fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

<!-- Side Drawer Mobile Menu - außerhalb des Headers -->
<div 
  id="mobile-menu" 
  class="mobile-menu md:pointer-events-none md:hidden bg-neutral-200 shadow-2xl text-right top-0 right-0 w-[75vw] p-4 fixed h-full z-50"
  inert
  aria-labelledby="mobile-menu-title"
>
  <nav role="navigation" aria-label="Mobile Hauptnavigation">
    <div class="flex flex-col gap-4 text-right justify-end">
      <button
        type="button"
        class="close-btn inline-flex gap-2 items-center px-5 h-10 justify-start self-start rounded-full md:hidden bg-neutral-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-700"
        aria-label="Hauptmenü schließen"
      >
        <span class="sr-only">Hauptmenü schließen</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 256 256"
          aria-hidden="true"
        >
          <path
            fill="currentColor"
            d="M208.49 191.51a12 12 0 0 1-17 17L128 145l-63.51 63.49a12 12 0 0 1-17-17L111 128L47.51 64.49a12 12 0 0 1 17-17L128 111l63.51-63.52a12 12 0 0 1 17 17L145 128Z"
          />
        </svg>
      </button>
      {menuItems.map((menuItem) => (
        <HeaderLink href={menuItem.slug}>
          <span class="icon" set:html={menuItem.icon} aria-hidden="true" />
          &nbsp;<span>{menuItem.label}</span>
        </HeaderLink>
      ))}
    </div>
  </nav>
</div>
<style>
  header {
    @apply bg-white drop-shadow-md sticky top-0 z-40;
    grid-area: header;
  }
  .wrapper {
    @apply container mx-auto px-4 py-2 flex justify-between items-center;
  }
  h2 {
    margin: 0.5em 0;
  }
  .icon svg {
    @apply block w-5 h-5;
  }
  
  /* Mobile Menu Styles */
  .mobile-backdrop {
    transition: opacity 0.3s ease-in-out;
  }
  
  .mobile-backdrop.mobile-backdrop--open {
    @apply block;
  }
  
  .mobile-menu {
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
  }
  
  .mobile-menu.mobile-menu--open {
    transform: translateX(0);
  }  /* Focus styles for better accessibility */
  button:focus-visible,
  a:focus-visible {
    @apply outline-none ring-2 ring-red-700 ring-offset-2;
  }
  
  /* High contrast mode support */
  @media (prefers-contrast: high) {
    header {
      @apply border-b-2 border-black;
    }
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .mobile-menu {
      transition: none;
    }
  }
  
  /* Body scroll lock when menu is open */
  html:has(.mobile-menu--open) {
    overflow: hidden;
  }
</style>

<script>
  const closeBtn = document.querySelector(".close-btn");
  const openBtn = document.querySelector(".open-btn") as HTMLButtonElement;
  const mobileMenu = document.querySelector("#mobile-menu") as HTMLElement;
  const mobileBackdrop = document.querySelector("#mobile-backdrop") as HTMLElement;
  
  // Open mobile menu (Side Drawer)
  openBtn?.addEventListener("click", () => {
    mobileMenu?.removeAttribute("inert");
    mobileMenu?.classList.add("mobile-menu--open");
    mobileBackdrop?.classList.add("mobile-backdrop--open");
    openBtn.setAttribute("aria-expanded", "true");
    
    // Focus management - focus first menu item
    const firstMenuItem = mobileMenu?.querySelector("a") as HTMLAnchorElement;
    firstMenuItem?.focus();
  });
  
  // Close mobile menu
  const closeMobileMenu = () => {
    mobileMenu?.classList.remove("mobile-menu--open");
    mobileBackdrop?.classList.remove("mobile-backdrop--open");
    mobileMenu?.setAttribute("inert", "true");
    openBtn?.setAttribute("aria-expanded", "false");
    openBtn?.focus(); // Return focus to open button
  };
  
  closeBtn?.addEventListener("click", closeMobileMenu);
  
  // Close on Escape key
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && mobileMenu?.classList.contains("mobile-menu--open")) {
      closeMobileMenu();
    }
  });
  
  // Close when clicking backdrop
  mobileBackdrop?.addEventListener("click", closeMobileMenu);
  
  // Trap focus within mobile menu
  mobileMenu?.addEventListener("keydown", (e) => {
    if (e.key === "Tab") {
      const focusableElements = mobileMenu.querySelectorAll('button, a, [tabindex="0"]');
      const firstElement = focusableElements[0] as HTMLElement;
      const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;
      
      if (e.shiftKey) {
        if (document.activeElement === firstElement) {
          e.preventDefault();
          lastElement.focus();
        }
      } else {
        if (document.activeElement === lastElement) {
          e.preventDefault();
          firstElement.focus();
        }
      }
    }
  });
</script>
